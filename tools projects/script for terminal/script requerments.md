# Requirements: Script Generation Wizard (Web Serial Terminal) V1.4

## 1. Introduction

### 1.1. Goal

To provide a guided, step-by-step user interface (a "wizard") within the Web Serial Terminal application for creating and editing automation scripts. This wizard aims to simplify the process by allowing users to describe their desired script logic in natural language, generating a tailored prompt for an external AI tool (requesting code and a final explanation comment within a single copyable block), displaying the AI's explanation separately, and providing a space to paste and save the combined code and comment.

### 1.2. Scope

This document defines the functional and UI requirements specifically for the script generation wizard feature. It assumes the existence of the main Web Serial Terminal application context, including defined TX commands, RX definitions, and the underlying Scripting API.

### 1.3. Target Users

Users of the Web Serial Terminal who want to create automation scripts but may prefer assistance from an AI tool, guided by the application, and require a plain-language explanation of the generated script's function.

## 2. Functional Requirements

### 2.1. Wizard Initiation

*   **FR2.1.1:** Provide a mechanism to launch the wizard for creating a *new* script.
*   **FR2.1.2:** Provide a mechanism to launch the wizard for *editing* an *existing* script.

### 2.2. Wizard Data Structure

*   **FR2.2.1:** Scripts managed by the application shall store `name`, `code` (JavaScript including the final explanation comment), and the user's original natural language `description`.

### 2.3. Wizard Flow - Step 1: Define Script Logic

*   **FR2.3.1:** Display UI elements for the user to enter/edit the **Script Name** (validated for non-empty, unique) and the **Script Logic Description**.
*   **FR2.3.2:** If editing, pre-fill fields.
*   **FR2.3.3:** Provide a "**Next: Generate Prompt**" button (validated).

### 2.4. Wizard Flow - Step 2: Generate & Review AI Prompt

*   **FR2.4.1:** Dynamically generate a detailed prompt for an external AI tool.
*   **FR2.4.2:** The generated prompt **must** include:
    *   **Objective:** Generate a JavaScript code snippet.
    *   **Scripting API:** Details of available functions.
    *   **Current Project Context:** Defined TX Commands and RX Definitions.
    *   **User's Script Request:** The natural language description from Step 1.
    *   **Instructions for AI:** Provide clear guidelines for the AI's output:
        *   Use *only* the provided Scripting API functions.
        *   Use `await` correctly.
        *   Include basic error handling.
        *   **Output Format:** Generate a **single** JavaScript code block (using ```javascript ... ``` fences). This single block must contain both the script code and the explanation comment described below.
        *   **Explanation Requirement:** At the **very end** of the JavaScript code, but still **inside the same code block**, include a block comment starting with `/** Script Explanation:` and ending with `*/`.
        *   Inside this final comment block, provide a simple, bullet-point explanation of the script's actions and timing in plain language. (Example format provided in prompt).
        *   **Crucially:** The entire response must be ONLY this single markdown code block. Do NOT include any text before the opening ```javascript or after the closing ```.
    *   **Instructions for User:** Briefly explain (outside the copied prompt) to copy the prompt, paste into AI, and paste the AI's *single code block response* back into the next step.
*   **FR2.4.3:** Display the prompt in a read-only text area.
*   **FR2.4.4:** Provide a "Copy Prompt" button.
*   **FR2.4.5:** Provide a "**Next: Paste Code**" button.
*   **FR2.4.6:** Provide a "Back" button.

### 2.5. Wizard Flow - Step 3: Paste, Review Explanation, & Save Code

*   **FR2.5.1:** Display UI elements for the user to:
    *   View the **AI's Explanation** in a read-only display area (extracted from the pasted code).
    *   Paste the *entire response* (the single code block containing code and the explanation comment) generated by the AI tool into a multi-line text area.
*   **FR2.5.2:** If editing, pre-fill the code text area and attempt to extract/display the explanation.
*   **FR2.5.3:** **Code Processing:** Implement an `oninput` listener for the code text area to automatically extract and display the text within the `/** Script Explanation: ... */` comment block in the separate read-only explanation area. Handle cases where the comment is missing.
*   **FR2.5.4:** **Code Checks (Optional):** Basic checks (e.g., non-empty).
*   **FR2.5.5:** Display a clear **Security Warning**.
*   **FR2.5.6:** Provide a "Save Script" button (validated). Saves Name, Description (Step 1), and the entire pasted Code (including comment). Closes wizard.
*   **FR2.5.7:** Provide a "Back" button.
*   **FR2.5.8:** Provide a "Cancel" button.

## 3. Non-Functional Requirements

*   **NFR3.1. Usability:** Intuitive flow, clear labels and buttons.
*   **NFR3.2. Clarity:** Well-formatted prompt. Readable explanation display.
*   **NFR3.3. Security:** Prominent warnings.

## 4. Scripting API Reference (For Prompt Generation)

*   `log(message: string)`
*   `await sleep(milliseconds: number): Promise<void>`
*   `await sendCommand(commandName: string): Promise<boolean>`
*   `await sendHex(hexString: string): Promise<boolean>`
*   `await sendAscii(asciiString: string): Promise<boolean>`
*   `await waitForData(options: object): Promise<object | null>`
    *   `options`: `{ pattern?: string | RegExp, timeout: number (ms), format?: 'ascii' | 'hex' | 'description' | 'raw' }`
*   `getCommands(): object[]`
*   `getRxDefinitions(): object`

